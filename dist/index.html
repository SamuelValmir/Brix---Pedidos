<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>

    <title>Pedidos</title>
</head>

<body>
    <div class="container p-5">

        <!-- <form action="http://192.168.100.20:9999/file/post" method="post" enctype="multipart/form-data"> -->
        <input type="file"
            accept=".xlsx, .xlsm, .xlsb, .xlsb, .xlsx, .xltx, .xltm, .xls, .xlt, .xml, .xlam, .xla, .xlw, .xlr"
            id="file" name="formattedTable">
        <!-- </form> -->

        <div class="" style="border: 1px solid black;">
            <table>
            </table>
        </div>

        <div>
            <button class="btn btn-primary" onclick=""> Selecionar elementos manualmente </button>
            Você poderá escolher quais colunas e linhas deseja manter
        </div>

        <div>
            <button class="btn btn-primary" onclick=""> Selecionar elementos automaticamente </button>
            A geração automática vai selecionar, como elementos, da coluna A à coluna F incluindo a coluna L (estado
            CE),
            a partir da linha 7 (Linhas vazias são consideradas como inexistente: Exemplo:(Em uma tabela com 4 linhas se
            a
            linha. (Se essas opções não estiverem de acordo com os dados da tabela, experimente selecionar os elementos
            manualmente)
        </div>

        Exemplo:
        2 estiver vazia, a primeira linha será a 1, a segunda a 3 e a terceira a 4 ))
        Deseja manter essas configurações?
        Manter Mudar configurações de geração

        <button class="btn btn-primary" onclick="sendFile()">Salvar Planilha</button>


        <div style="display:none">
            (dialog box)
            Depois de salvo os dados não selecionados serão permanentemente excluídos. Deseja prosseguir?
            voltar confirmar


            Gerando
        </div>

    </div>
    <div class="bg-dark w-100 h-100 position-absolute top-0 bg-opacity-50 d-flex justify-content-center align-items-center flex-column visually-hidden"
        id="loader-container">
        <div class="spinner-border text-primary fs-1" id="loader"></div>
        <div class="text-light pt-5 fs-2">Carregando Documento</div>
    </div>



    <script>

        // function getFile() {

        //     fetch("http://192.168.100.20:9999/file/get", { method: "GET" })
        //         // .then(response=>response.body.getReader())
        //         .then(data => {
        //             console.log(data)
        //         })
        // }


        function sendFile() {
            // const inputFile = document.querySelector("#file");
            // const file = inputFile.files[0];
            // console.log(file)
            // const formData = new FormData();
            // formData.append("inputtedTable", file);

            // // fetch("http://192.168.100.20:9999/file/post?a=123", {
            // fetch("http://localhost:9999/file/post?a=123", {
            //     method: "POST",
            //     // headers: {"Content-Type": "multipart/form-data", "boundary": "----WebKitFormBoundaryKkKASB0dr15NjVIx"},
            //     body: formData
            // })
            // .then(request => request.body)
            // .then(json => {
            //     console.log(json);
            // })


        };


        const inputFile = document.querySelector("#file");
        const file = inputFile.files[0];
        const formData = new FormData();
        formData.append("tabela", file);

        const div = document.querySelector(".div");
        const table = document.querySelector("table");
        const tableBody = document.createElement("tbody");
        table.appendChild(tableBody);

        inputFile.addEventListener("change", () => showTableOnPage());

         async function showTableOnPage() {
            const loader = document.querySelector("#loader-container");
            loader.classList.remove("visually-hidden");

             await readXlsxFile(inputFile.files[0])
                .then(rows => {
                    rows.forEach((row, rowIndex) => {
                        const rowElementHead = document.createElement("tr");
                        // if (index >= 6) {
                        const rowElement = document.createElement("tr");
                        /* I must:
                        colors
                        select column and start point line
                        */
                        let charCode = 65;
                        let firstRepetitionOfColumnName = true;

                        let columnNameArray = [String.fromCharCode(charCode)];

                        row.forEach((cell, cellIndex) => {


                            columnNameArray.splice(-1);
                            columnNameArray.push(String.fromCharCode(charCode));
                            let columnName = columnNameArray.join("");

                            insertRow(rowElement, rowIndex, rowElementHead, cell, charCode, firstRepetitionOfColumnName, columnNameArray);
                            charCode++;

                            // When goes through all letters, goes back increasing the first letter
                            if (charCode % 91 === 0) {
                                charCode = 65;
                                columnNameArray = ["A", String.fromCharCode(charCode)];

                                if (firstRepetitionOfColumnName) firstRepetitionOfColumnName = false;
                                else {
                                    const charCode = columnNameArray[0].charCodeAt(0);
                                    columnNameArray[0] = String.fromCharCode(charCode + 1);
                                };
                            };

                        });

                        if (rowIndex === 0) {
                            tableBody.appendChild(rowElementHead);
                        };

                        tableBody.appendChild(rowElement);
                    });

                });

            loader.classList.add("visually-hidden");

        };


        function insertRow(rowElement, rowIndex, rowElementHead, cell, charCode, firstRepetitionOfColumnName, columnName) {
            if (rowIndex === 0) {
                const cellElementHead = document.createElement("td");
                cellElementHead.innerText = columnName
                rowElementHead.appendChild(cellElementHead);
            };
            // if (index < 6 || index === 11) {

            insertCell(rowElement, cell);
        };

        function insertCell(rowElement, cell) {
            const cellElement = document.createElement("td");
            cellElement.innerText = cell;
            rowElement.appendChild(cellElement);
        };
    </script>
</body>

</html>